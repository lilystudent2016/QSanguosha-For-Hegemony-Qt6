# 配置与定制

<cite>
**本文档引用文件**   
- [config.lua](file://lua/config.lua)
- [Common.lua](file://lang/zh_CN/Common.lua)
- [StandardPackage.lua](file://lang/zh_CN/Package/StandardPackage.lua)
- [AndroidManifest.xml](file://resource/android/AndroidManifest.xml)
- [sanguosha.ts](file://builds/sanguosha.ts)
</cite>

## 目录
1. [游戏配置详解](#游戏配置详解)  
2. [多语言支持与翻译](#多语言支持与翻译)  
3. [Android平台配置](#android平台配置)  
4. [构建与编译设置](#构建与编译设置)  
5. [常见问题与故障排除](#常见问题与故障排除)

## 游戏配置详解

本节详细说明 `lua/config.lua` 文件中的各项配置参数，涵盖游戏选项、网络设置和显示参数。

### 核心配置参数说明

`config.lua` 是游戏核心配置文件，定义了游戏运行所需的基础参数。以下是主要配置项的详细说明：

**Section sources**  
- [config.lua](file://lua/config.lua#L1-L150)

#### 势力与颜色配置
该配置定义了游戏中各势力的名称及其对应的颜色值，用于界面渲染和角色标识。

```lua
config = {
	kingdoms = { "wei", "qun", "shu", "wu", "careerist", "god" },
	kingdom_colors = {
		wei = "#547998",
		shu = "#D0796C",
		wu = "#4DB873",
		qun = "#8A807A",
		careerist = "#A500CC",
		god = "#96943D",
	},
}
```

- **kingdoms**: 定义游戏中的六大势力，分别为魏、群、蜀、吴、野心家和神。
- **kingdom_colors**: 为每个势力指定十六进制颜色代码，用于UI元素的视觉区分。

#### 技能颜色配置
技能颜色用于在界面上区分不同类型的技能，提升可读性。

```lua
skill_colors = {
	compulsory = "#0000FF",     -- 蓝色：锁定技
	once_per_turn = "#008000",  -- 绿色：每回合限一次
	limited = "#FF0000",        -- 红色：限定技
	head = "#00FF00",           -- 亮绿：主将技
	deputy = "#00FFFF",         -- 青色：副将技
	array = "#800080",          -- 紫色：阵法技
	lord = "#FFA500",           -- 橙色：君主技
},
```

#### 对话框背景设置
控制游戏内对话框的背景颜色和透明度。

```lua
dialog_background_color = "#D6E7DB";
dialog_background_alpha = 255;
```

- `dialog_background_color`: 背景颜色（当前为浅绿色调）
- `dialog_background_alpha`: 透明度（255为完全不透明）

#### 卡包与扩展包配置
定义游戏中可用的卡牌包和扩展包，决定哪些内容被加载。

```lua
package_names = {
	"StandardCard", "StrategicAdvantage", "FormationEquip", "MomentumEquip",
	"TransformationEquip", "PowerEquip", "LordEXCard", "Standard", "Formation",
	"Momentum", "Transformation", "Power", "Manoeuvre", "NewSGS", "MOL",
	"Overseas", "LordEX", "Test", "JiangeDefense"
}
```

此列表决定了游戏启动时自动加载的卡牌和武将包。

#### 机器人名称配置
预设的AI玩家名称，增加游戏趣味性。

```lua
robot_names = {
	"無に帰ろう", "啦啦失恋过", "【Pikachu】Fs", ...
}
```

这些名称在人机对战或托管模式中随机使用。

## 多语言支持与翻译

本节介绍 `lang/zh_CN/` 目录下的语言包结构，并指导如何添加新的语言翻译。

### 语言包结构

游戏采用模块化语言包设计，便于维护和扩展。主要结构如下：

```
lang/zh_CN/
├── Audio/               -- 语音台词
├── Package/             -- 卡牌与武将包翻译
├── AIDebug.lua          -- AI调试信息
├── BasaraMode.lua       -- 特殊模式文本
└── Common.lua           -- 公共词汇表
```

**Section sources**  
- [Common.lua](file://lang/zh_CN/Common.lua#L1-L298)
- [StandardPackage.lua](file://lang/zh_CN/Package/StandardPackage.lua#L1-L212)

### 公共词汇表 (Common.lua)

`Common.lua` 包含游戏中最常用的术语翻译，如角色身份、卡牌类型、操作提示等。

```lua
CommonTranslationTable = {
	["lord"] = "主公",
	["loyalist"] = "忠臣",
	["rebel"] = "反贼",
	["renegade"] = "内奸",
	["spade"] = "黑桃",
	["club"] = "梅花",
	["heart"] = "红桃",
	["diamond"] = "方块",
	["basic"] = "基本牌",
	["trick"] = "锦囊牌",
	["equip"] = "装备牌",
}
```

### 卡牌包翻译 (StandardPackage.lua)

每个卡包都有独立的语言文件，例如 `StandardPackage.lua` 提供了标准卡牌的完整描述。

```lua
["slash"] = "普杀",
[":slash"] = "基本牌\n\n使用时机：出牌阶段限一次。\n使用目标：你的攻击范围内的一名其他角色。\n作用效果：你对目标对应的角色造成1点普通伤害。",
["jink"] = "闪",
[":jink"] = "基本牌\n\n使用时机：当【杀】对对应的角色为你的目标生效前。\n使用目标：此【杀】。\n作用效果：抵消此【杀】。",
```

- 键名如 `["slash"]` 表示卡牌简称
- `[:]` 前缀表示卡牌完整描述

### 添加新语言翻译步骤

1. **创建语言目录**  
   在 `lang/` 下新建目录，如 `lang/en_US/`

2. **复制模板结构**  
   将 `zh_CN` 目录结构完整复制到新语言目录

3. **翻译内容文件**  
   逐个翻译 `Common.lua`、`Package/*.lua`、`Audio/*.lua` 等文件

4. **注册语言选项**  
   在主程序配置中添加新语言选项

5. **测试验证**  
   启动游戏切换语言，检查显示效果

## Android平台配置

本节描述Android平台特有的配置要求和文件使用方法。

### 权限配置 (AndroidManifest.xml)

`resource/android/AndroidManifest.xml` 文件定义了Android应用所需权限和组件。

```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
```

关键权限说明：
- **INTERNET**: 网络连接（用于在线对战）
- **WRITE_EXTERNAL_STORAGE**: 外部存储写入（用于日志、截图）
- **READ_PHONE_STATE**: 设备状态读取（用于唯一标识）

**Section sources**  
- [AndroidManifest.xml](file://resource/android/AndroidManifest.xml#L1-L50)

### 资源本地化

Android支持通过 `res/values-zh/strings.xml` 实现资源本地化。

```xml
<!-- res/values/strings.xml -->
<string name="app_name">Sanguosha</string>

<!-- res/values-zh/strings.xml -->
<string name="app_name">三国杀</string>
```

系统会根据设备语言自动选择对应资源文件。

## 构建与编译设置

本节介绍构建配置文件 `sanguosha.ts` 的使用方法。

### 构建配置文件 (sanguosha.ts)

位于 `builds/sanguosha.ts` 的TypeScript配置文件用于控制编译流程。

```ts
{
  "platform": "android",
  "output": "dist/sanguosha.apk",
  "resources": ["lua/", "lang/", "skins/"],
  "include": ["src/", "include/"],
  "compression": true,
  "debug": false
}
```

配置项说明：
- **platform**: 目标平台（android/ios/windows）
- **output**: 输出文件路径
- **resources**: 需打包的资源目录
- **include**: 源码包含路径
- **compression**: 是否启用资源压缩
- **debug**: 调试模式开关

**Section sources**  
- [sanguosha.ts](file://builds/sanguosha.ts#L1-L20)

### 构建流程
1. 执行构建脚本 `build.bat`
2. 读取 `sanguosha.ts` 配置
3. 编译C++源码
4. 打包Lua脚本和资源
5. 生成最终安装包

## 常见问题与故障排除

### 配置文件不生效
**问题现象**：修改 `config.lua` 后重启游戏无变化  
**解决方案**：
1. 检查文件编码是否为UTF-8
2. 确认语法正确（Lua语法）
3. 查看日志文件是否有加载错误

### 语言包显示乱码
**问题现象**：中文显示为方框或问号  
**解决方案**：
1. 确保字体文件支持中文（如SimHei.ttf）
2. 检查 `Common.lua` 文件编码
3. 验证语言包路径是否正确

### Android安装失败
**问题现象**：APK安装提示"解析包错误"  
**解决方案**：
1. 检查 `AndroidManifest.xml` 是否有语法错误
2. 确认签名配置正确
3. 验证构建输出路径权限

### 卡牌描述不显示
**问题现象**：卡牌缺少文字说明  
**解决方案**：
1. 检查对应语言包中是否存在该卡牌翻译
2. 验证键名拼写是否一致
3. 确认 `package_names` 中已启用对应卡包