# 快速入门

<cite>
**本文档中引用的文件**   
- [README.md](file://README.md)
- [qm_mover.bat](file://qm_mover.bat)
- [config.lua](file://lua/config.lua)
- [sanguosha.lua](file://lua/sanguosha.lua)
- [about_us.lua](file://lua/about_us.lua)
- [1-Start.lua](file://extension-doc/1-Start.lua)
- [Xmode.lua](file://extensions/Xmode.lua)
</cite>

## 目录
1. [项目简介](#项目简介)
2. [获取代码](#获取代码)
3. [开发环境配置](#开发环境配置)
4. [编译构建项目](#编译构建项目)
5. [运行游戏](#运行游戏)
6. [辅助脚本说明](#辅助脚本说明)
7. [首次运行体验](#首次运行体验)
8. [编写第一个扩展脚本](#编写第一个扩展脚本)

## 项目简介

《三国杀》是一款广受欢迎的桌面卡牌游戏，本项目旨在复刻其在线版本。整个项目使用C++编写，采用Qt图形视图框架作为游戏引擎，并利用Lua脚本实现AI和扩展功能。项目开源，支持多种扩展包和MOD，具有良好的可扩展性。

**Section sources**
- [README.md](file://README.md#L1-L20)

## 获取代码

要开始使用本项目，首先需要从代码仓库获取源代码。假设您已经安装了Git工具，可以通过以下命令克隆项目：

```bash
git clone https://github.com/QSanguosha-Rara/QSanguosha-For-Hegemony.git
```

克隆完成后，您将在本地得到一个名为`QSanguosha-For-Hegemony`的目录，其中包含了项目的所有源代码和资源文件。

**Section sources**
- [README.md](file://README.md#L20-L30)

## 开发环境配置

本项目需要以下开发环境：

- **C++编译器**: 支持C++11标准的编译器
- **Qt开发框架**: 版本5.3.x
- **Lua脚本引擎**: 用于AI和扩展脚本
- **FMOD音频引擎**: 用于游戏音效
- **FreeType字体渲染库**: 用于字体显示

### Windows平台配置

1. 下载并安装Qt Libraries for Windows (Visual Studio 2013, 5.3.0)
2. 安装Visual Studio 2013或更高版本
3. 确保环境变量中包含Qt的bin目录

### macOS平台配置

1. 从App Store安装XCode并启用命令行工具
2. 下载并安装Qt Creator
3. 安装SWIG工具（版本3.0.1或更高）

### Linux平台配置

1. 从软件源或Qt官网下载并安装Qt Libraries 5.3.x
2. 安装SWIG工具
3. 确保系统中已安装g++编译器

**Section sources**
- [README.md](file://README.md#L50-L100)

## 编译构建项目

### Windows平台（Visual Studio 2013）

1. 打开`~/builds/vs2013/Qsanguosha.sln`解决方案文件
2. 在解决方案资源管理器中，将配置更改为"Release Qt5|Win32"
3. 右键点击"QSanguosha"项目，选择"属性"，在"调试"选项卡中设置"工作目录"为`$(ProjectDir)..\..\`
4. 构建解决方案
5. 编译成功后，`QSanguosha.exe`将生成在`~/Bin`目录下

### macOS平台

1. 使用Qt Creator打开`QSanguosha.pro`文件
2. 配置项目，确保使用clang编译
3. 更改配置为Release模式
4. 构建项目
5. 使用`otool`和`install_name_tool`修复库文件路径
6. 运行`macdeployqt`工具进行部署

### Linux平台

1. 使用Qt Creator打开`QSanguosha.pro`文件
2. 配置项目，确保使用g++编译
3. 更改配置为Release模式
4. 构建项目

**Section sources**
- [README.md](file://README.md#L100-L200)

## 运行游戏

编译成功后，按照以下步骤运行游戏：

1. 将生成的可执行文件移动到项目根目录
2. 复制必要的依赖库文件到可执行文件所在目录
3. 双击运行可执行文件

对于Windows平台，需要复制以下Qt库文件：
- Qt5Core.dll
- Qt5Gui.dll
- Qt5Network.dll
- Qt5Qml.dll
- Qt5Quick.dll
- Qt5Widgets.dll

以及Visual Studio运行时库文件：
- msvcp120.dll
- msvcr120.dll

**Section sources**
- [README.md](file://README.md#L200-L250)

## 辅助脚本说明

项目中包含一个名为`qm_mover.bat`的批处理脚本，其主要功能是将编译生成的语言文件复制到当前目录。

### qm_mover.bat脚本功能

该脚本位于项目根目录下，内容如下：

```batch
@echo off
@echo Copying sanguosha.qm, please wait...
copy builds\sanguosha.qm %cd%\
```

此脚本的作用是将`builds`目录下的`sanguosha.qm`文件复制到当前工作目录，该文件包含了游戏的中文翻译信息。

**Section sources**
- [qm_mover.bat](file://qm_mover.bat#L1-L4)

## 首次运行体验

首次运行游戏时，您将看到以下界面：

1. 主菜单界面，包含"开始游戏"、"设置"、"关于"等选项
2. 游戏场景采用精美的三国风格设计
3. 支持键盘快捷键操作
4. 可以双击使用卡牌
5. 卡牌支持按类型和花色排序

游戏内置了多种模式，包括标准模式、国战模式等。您可以选择单人模式与AI对战，或选择多人模式与其他玩家联机游戏。

AI玩家的名称来自社区贡献，如"無に帰ろう"、"啦啦失恋过"等，增加了游戏的趣味性。

**Section sources**
- [config.lua](file://lua/config.lua#L1-L50)
- [sanguosha.lua](file://lua/sanguosha.lua#L1-L20)

## 编写第一个扩展脚本

本项目支持通过Lua脚本进行功能扩展。让我们创建一个简单的扩展脚本作为入门示例。

### 创建基础扩展

1. 在`extensions`目录下创建一个新的Lua文件，例如`MyFirstExtension.lua`
2. 编辑文件内容：

```lua
-- 我的第一个扩展
local extension = LuaPackage("MyFirstExtension")

-- 添加一个简单的技能
local mySkill = sgs.CreateTriggerSkill{
    name = "my_first_skill",
    frequency = sgs.Skill_NotFrequent,
    events = {sgs.EventPhaseStart},
    on_trigger = function(self, event, player, data)
        local room = player:getRoom()
        room:notifySkillInvoked(player, "my_first_skill")
        room:sendCompulsoryTriggerLog(player, "my_first_skill")
        return false
    end
}

extension:insertSkill(mySkill)
sgs.Sanguosha:addPackage(extension)
```

3. 保存文件

### 扩展脚本结构说明

从`extension-doc/1-Start.lua`文件中，我们可以了解扩展脚本的基本结构：

- 使用`LuaPackage`创建扩展包
- 使用`CreateTriggerSkill`等函数创建技能
- 通过`insertSkill`方法将技能添加到扩展包
- 使用`addPackage`将扩展包注册到游戏中

### 测试扩展效果

1. 重新编译项目或确保Lua脚本被正确加载
2. 启动游戏
3. 在游戏中选择包含此扩展的模式
4. 观察角色是否获得了新技能

您可以通过修改脚本中的技能名称、触发条件等参数来观察不同的效果。

**Section sources**
- [extension-doc/1-Start.lua](file://extension-doc/1-Start.lua#L1-L20)
- [extensions/Xmode.lua](file://extensions/Xmode.lua#L1-L10)
- [sanguosha.lua](file://lua/sanguosha.lua#L50-L80)